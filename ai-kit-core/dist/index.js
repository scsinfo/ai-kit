var Fe=Object.defineProperty;var A=(e,t)=>()=>(e&&(t=e(e=0)),t);var V=(e,t)=>{for(var r in t)Fe(e,r,{get:t[r],enumerable:!0})};function B(){return globalThis.WpSuite?.plugins?.aiKit}async function ae(e=8e3){let t=B();if(t?.status!=="available"){if(t?.status==="error")throw new Error("AiKit failed");await new Promise((r,n)=>{let a=()=>s(r),o=()=>s(()=>n(new Error("AiKit failed"))),s=u=>{window.removeEventListener("wpsuite:ai-kit:ready",a),window.removeEventListener("wpsuite:ai-kit:error",o),i&&clearTimeout(i),u()};window.addEventListener("wpsuite:ai-kit:ready",a,{once:!0}),window.addEventListener("wpsuite:ai-kit:error",o,{once:!0});let i=e?window.setTimeout(()=>s(()=>n(new Error("AiKit timeout"))),e):0})}}async function De(e=1e4){await ae(e);let r=B()?.features?.store;if(!r)throw new Error("AiKit store is not available");return r}var G=A(()=>{"use strict"});import{getConfig as Ue}from"@smart-cloud/wpsuite-core";import{createReduxStore as ze,dispatch as We,register as Ne,select as _e,subscribe as He}from"@wordpress/data";import{I18n as oe}from"aws-amplify/utils";var $,se,qe,je,Ve,Ge,$e,Xe,N,ie,Je,_=A(()=>{"use strict";G();typeof WpSuite<"u"?$=WpSuite.siteSettings:$={};se=e=>{let t=e&&typeof e=="object"?e:{},r={};return typeof t.mode=="string"&&(r.mode=t.mode),typeof t.backendTransport=="string"&&(r.backendTransport=t.backendTransport),typeof t.backendApiName=="string"&&(r.backendApiName=t.backendApiName),typeof t.backendBaseUrl=="string"&&(r.backendBaseUrl=t.backendBaseUrl),typeof t.subscriptionType=="string"&&(r.subscriptionType=t.subscriptionType),typeof t.enableChatbot=="boolean"&&(r.enableChatbot=t.enableChatbot),typeof t.chatbot=="object"&&t.chatbot!==null&&(r.chatbot=t.chatbot),r},qe=async()=>{let e=B();if(!e)throw new Error("AI-Kit plugin is not available");let t=null;return e.settings.customTranslationsUrl&&(t=await fetch(e.settings.customTranslationsUrl+(e.settings.customTranslationsUrl.includes("?")?"&":"?")+"t="+$.lastUpdate).then(r=>r.ok?r.text():null).then(r=>r?JSON.parse(r):null).catch(()=>null)),t??null},je=async()=>{let e=se(await Ue("aiKit")),t=await qe();return{config:e,showChatbotPreview:!1,language:void 0,direction:void 0,customTranslations:t}},Ve={setShowChatbotPreview(e){return{type:"SET_SHOW_CHATBOT_PREVIEW",showChatbotPreview:e}},setLanguage(e){return!e||e==="system"?oe.setLanguage(""):oe.setLanguage(e),{type:"SET_LANGUAGE",language:e}},setDirection(e){return{type:"SET_DIRECTION",direction:e}}},Ge={getConfig(e){return e.config},isShowChatbotPreview(e){return e.showChatbotPreview},getCustomTranslations(e){return e.customTranslations},getLanguage(e){return e.language},getDirection(e){return e.direction},getState(e){return e}},$e={},Xe=e=>We(e),N=e=>_e(e),ie=async()=>{let e=await je(),t=ze("wpsuite/ai-kit",{reducer(r=e,n){switch(n.type){case"SET_LANGUAGE":return{...r,language:n.language};case"SET_DIRECTION":return{...r,direction:n.direction};case"SET_SHOW_CHATBOT_PREVIEW":return{...r,showChatbotPreview:n.showChatbotPreview}}return r},actions:Ve,selectors:Ge,resolvers:$e});return Ne(t),t},Je=(e,t,r)=>{let n;function a(){let s=N(e).getState(),i=t(s);if(i!==n){let u=n;n=i,r(n,u)}}let o=He(a,e);return a(),o}});var y,ue=A(()=>{"use strict";y="smartcloud-ai-kit"});import{jsx as k,jsxs as X}from"react/jsx-runtime";var sr,ir,ur,ce=A(()=>{"use strict";sr=e=>X("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"48",height:"48",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[k("path",{d:"M19 27H33"}),k("path",{d:"M19 33H33"}),k("path",{d:"M8 21L9.5 24L12.5 25.5L9.5 27L8 30L6.5 27L3.5 25.5L6.5 24Z"}),k("path",{d:"M36 4L38 8L42 10L38 12L36 16L34 12L30 10L34 8Z"}),k("path",{d:"M16 10V40H36V22"}),k("path",{d:"M16 10H22"}),k("path",{d:"M22 10V23H36"}),k("path",{d:"M22 10L36 22"})]}),ir=e=>X("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"48",height:"48",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[k("path",{d:"M42 38L34 30H10C7.79086 30 6 28.2091 6 26V8C6 5.79086 7.79086 4 10 4H38C40.2091 4 42 5.79086 42 8V38Z"}),k("rect",{x:"14",y:"13",width:"6",height:"6",rx:"1"}),k("rect",{x:"28",y:"13",width:"6",height:"6",rx:"1"}),k("path",{d:"M16 24H32"})]}),ur=e=>X("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[k("path",{stroke:"none",d:"M0 0h48v48H0z",fill:"none"}),k("path",{d:"M6 20a14 14 0 1 0 28 0a14 14 0 1 0 -28 0"}),k("path",{d:"M42 42l-12 -12"}),k("path",{d:"M20 20a3 3 0 1 0 -2.28 -4.948"}),k("circle",{cx:"20",cy:"26",r:"0.9",fill:"currentColor",stroke:"none"})]})});var x,J=A(()=>{"use strict";x=class extends Error{constructor(r,n,a){super(r);this.decision=n;this.status=a;this.name="AiBackendError"}}});var fe={};V(fe,{MIN_CHROME_VERSION:()=>ge,checkOnDeviceAvailability:()=>me,decideCapability:()=>q,resolveBackend:()=>M});import{getWpSuite as Qe}from"@smart-cloud/wpsuite-core";async function le(){let t=await Ze?.plugins?.aiKit?.features.store;return N(t).getConfig()??{}}function de(e){let t=e.backendApiName?.trim()||void 0,r=e.backendBaseUrl?.trim()||void 0;return{transport:e.backendTransport??(r?"fetch":t?"gatey":void 0),backendApiName:t,backendBaseUrl:r}}function Ye(e){if(e.mode)return e.mode;let{transport:t}=de(e);return t?"backend-fallback":"local-only"}async function M(){let e=await le(),{transport:t,backendApiName:r,backendBaseUrl:n}=de(e);if(!t)return{available:!1,reason:"No backend configured"};if(t==="fetch")return n?{available:!0,transport:t,baseUrl:n,reason:"Custom fetch backend"}:{available:!1,reason:"backendBaseUrl is missing"};if(!r)return{available:!1,reason:"backendApiName is missing"};let a=globalThis.WpSuite?.plugins?.gatey;return!a?.availability||await a.availability()!=="available"?{available:!1,reason:"Gatey is not available"}:{available:!0,transport:t,apiName:r,reason:"Gatey backend"}}function L(e){return typeof globalThis[e]<"u"}function pe(e){if(!e)return;let t=Number.parseInt(String(e).split(".")[0]??"",10);return Number.isFinite(t)?t:void 0}function H(e,t){return e?.find(r=>r.brand===t)?.version}async function et(){let e=navigator?.userAgentData;if(e){try{let r=(await e.getHighEntropyValues?.(["fullVersionList"]))?.fullVersionList;if(Array.isArray(r)&&r.length>0)return r}catch{}if(Array.isArray(e.brands)&&e.brands.length>0)return e.brands}}function tt(e){let t=e.match(/\b(?:Chrome|Chromium)\/(\d{2,3})\b/i);return t?.[1]?pe(t[1]):void 0}function rt(){return!!navigator?.brave}async function nt(e){if(typeof navigator>"u")return{allowed:!1,reason:"no-navigator"};if(typeof globalThis.isSecureContext=="boolean"&&!globalThis.isSecureContext)return{allowed:!1,reason:"not-secure-context"};let t=navigator.userAgent??"",r=await et(),n=H(r,"Microsoft Edge")??H(r,"Microsoft Edge WebView2"),a=H(r,"Google Chrome")??H(r,"Chromium"),o=!!n||/\bEdg\//i.test(t)||/\bEdgiOS\//i.test(t),s=/\bOPR\//i.test(t),i=/\bVivaldi\//i.test(t),u=/\bSamsungBrowser\//i.test(t),c=/\bFirefox\//i.test(t),g=!/\bChrome\//i.test(t)&&/\bSafari\//i.test(t)&&!/\bChromium\//i.test(t),l=rt()||/\bBrave\//i.test(t);if(o||s||i||u||c||g||l)return{allowed:!1,reason:o?"edge":l?"brave":c?"firefox":g?"safari":s?"opera":i?"vivaldi":u?"samsung":"unsupported-browser"};let p=pe(a)??tt(t),f=ge[e];return f?p?p<f?{allowed:!1,reason:`chrome-too-old-${p}-lt-${f}`,chromeMajor:p}:{allowed:!0,reason:"ok",chromeMajor:p}:{allowed:!1,reason:"unknown-chrome-version"}:{allowed:!1,reason:"no-min-version",chromeMajor:p}}async function me(e,t){try{let r=await nt(e),n=`browser-gate:${r.reason}${r.chromeMajor?` (chrome ${r.chromeMajor})`:""}`;if(!r.allowed)return{available:!1,status:"unavailable",reason:n};switch(e){case"writer":{if(!L("Writer")||!Writer?.availability)return{available:!1,status:"api-not-present",reason:n};let a=await Writer.availability(t);return{available:a!=="unavailable",status:a,reason:n}}case"rewriter":{if(!L("Rewriter")||!Rewriter?.availability)return{available:!1,status:"api-not-present",reason:n};let a=await Rewriter.availability(t);return{available:a!=="unavailable",status:a,reason:n}}case"summarizer":{if(!L("Summarizer")||!Summarizer?.availability)return{available:!1,status:"api-not-present",reason:n};let a=await Summarizer.availability(t);return{available:a!=="unavailable",status:a,reason:n}}case"proofreader":{if(!L("Proofreader")||!Proofreader?.availability)return{available:!1,status:"api-not-present",reason:n};let a=await Proofreader.availability(t);return{available:a!=="unavailable",status:a,reason:n}}case"language-detector":{if(!L("LanguageDetector")||!LanguageDetector?.availability)return{available:!1,status:"api-not-present",reason:n};let a=await LanguageDetector.availability(t);return{available:a!=="unavailable",status:a,reason:n}}case"translator":{if(!L("Translator")||!Translator?.availability)return{available:!1,status:"api-not-present",reason:n};let a=t;if(!a?.sourceLanguage||!a?.targetLanguage)return{available:!1,status:"error",reason:n,error:new Error("Translator.availability requires sourceLanguage/targetLanguage")};let o=await Translator.availability({...a,sourceLanguage:a.sourceLanguage==="auto"?"en":a.sourceLanguage,targetLanguage:a.sourceLanguage==="auto"||a.sourceLanguage===a.targetLanguage?"hu":a.targetLanguage});return{available:o!=="unavailable",status:o,reason:n}}case"prompt":{if(!L("LanguageModel")||!LanguageModel?.availability)return{available:!1,status:"api-not-present",reason:n};let a=await LanguageModel.availability(t);return{available:a!=="unavailable",status:a,reason:n}}default:return{available:!1,status:"unknown-feature",reason:n}}}catch(r){return{available:!1,status:"error",reason:"exception in availability()",error:r}}}async function q(e,t,r){let n=await le(),a=r||Ye(n),o=await M(),s=await me(e,t),i=s.available,u=o.available,c={feature:e,mode:a,onDeviceAvailable:i,onDeviceStatus:s.status,onDeviceReason:s.reason,backendAvailable:u,backendTransport:o.transport,backendApiName:o.apiName,backendBaseUrl:o.baseUrl,backendReason:o.reason};return a==="local-only"?i?{...c,source:"on-device",reason:`local-only: on-device available (${s.reason??s.status})`}:{...c,source:"none",reason:`local-only: on-device unavailable (${s.reason??s.status})`}:a==="backend-only"?u?{...c,source:"backend",reason:`backend-only: backend available (${o.reason??"n/a"})`}:{...c,source:"none",reason:`backend-only: backend unavailable (${o.reason??"n/a"})`}:i?{...c,source:"on-device",reason:`backend-fallback: using on-device (${s.reason??s.status})`}:u?{...c,source:"backend",reason:`backend-fallback: using backend (${o.reason??"n/a"}; on-device: ${s.reason??s.status})`}:{...c,source:"none",reason:`No on-device AI or backend available (on-device: ${s.reason??s.status}; backend: ${o.reason??"n/a"})`}}var Ze,ge,Q=A(()=>{"use strict";_();Ze=Qe();ge={summarizer:138,translator:138,"language-detector":138,writer:137,rewriter:137,proofreader:141,prompt:138}});var ve={};V(ve,{dispatchBackend:()=>E,withRecaptchaHeaders:()=>D});import{getRecaptcha as at}from"@smart-cloud/wpsuite-core";function ot(){return globalThis.WpSuite?.plugins?.aiKit?.settings??{}}function st(e){if(!e)return;let t=Date.parse(e);return Number.isFinite(t)?t:void 0}function it(e){let t=e?.reCaptchaChatTtlSeconds,r=typeof t=="number"&&Number.isFinite(t)?Math.max(0,t):120;return Math.min(3600,r)*1e3}function ut(e,t){let r=it(t);if(r<=0)return!1;let n=be.get(e);return n?Date.now()-n<r:!1}function Z(e,t){let r=st(t);r&&be.set(e,r)}function ye(e,t,r){if(e!=="frontend"||t!=="prompt"||!he(r)||r.saveChatSession!==!0)return;let n=r.sessionId;return typeof n=="string"&&n.trim()?n.trim():void 0}function we(e,t){if(!e)return;try{if(typeof e.get=="function")return e.get(t)??void 0}catch{}let r=Object.keys(e).find(a=>a.toLowerCase()===t.toLowerCase());if(!r)return;let n=e[r];return typeof n=="string"&&n?n:void 0}async function ct(e,t){if(e!=="frontend")return;let r=ot();if(!r?.reCaptchaSiteKey||t?.cacheKey&&ut(t.cacheKey,r))return;let{execute:n}=await at(r?.useRecaptchaEnterprise||!1);if(typeof n=="function")try{let o=await n(r.reCaptchaSiteKey,{action:"generate"});return typeof o=="string"&&o?o:void 0}catch{return}}async function D(e,t,r){if(e!=="frontend"||t["X-Recaptcha-Token"]||t["x-recaptcha-token"])return t;let n=await ct(e,r);return n?{...t,"X-Recaptcha-Token":n}:t}function K(e,t){try{e?.onStatus?.(t)}catch{}}function he(e){return typeof e=="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null)}function dt(e,t){if(!he(t))return t;let r=lt[e];if(!r)return t;let n={};for(let a of r)a in t&&(n[a]=t[a]);return n}function mt(e,t){return(e==="admin"?gt:pt)[t]}async function E(e,t,r,n,a={}){let o=mt(t,r),s=dt(r,n);if(!o)throw new x(`No backend path configured for "${r}" (${t}).`,e);if(e.backendTransport==="fetch"){if(!e.backendBaseUrl)throw new x("backendTransport=fetch but backendBaseUrl is missing.",e);return ft(e.backendBaseUrl,o,s,a,e,r,t)}if(!e.backendApiName)throw new x("backendTransport=gatey but backendApiName is missing.",e);return bt(e.backendApiName,o,s,a,e,r,t)}async function ft(e,t,r,n,a,o,s){let i=`${e.replace(/\/+$/,"")}${t}`,u={"content-type":"application/json",...n.headers??{}},c=ye(s,o,r),g=await D(s,u,{cacheKey:c}),l=n.query&&Object.keys(n.query).length>0?"?"+new URLSearchParams(Object.entries(n.query).map(([m,v])=>[m,String(v)])).toString():"";K(n,{feature:o,context:s,step:"backend:request",source:"backend"}),K(n,{feature:o,context:s,step:"backend:waiting",source:"backend"});let p=await fetch(i+l,{method:"POST",headers:g,body:JSON.stringify(r??{}),signal:n.signal,credentials:"omit"});if(K(n,{feature:o,context:s,step:"backend:response",source:"backend"}),!p.ok){let m=`HTTP ${p.status}`;try{let v=await p.text();v&&(m=`${m}: ${v.substring(0,400)}`)}catch{}throw new x(`Fetch backend call failed: ${m}`,a,p.status)}let f=p.headers.get("content-type")||"",h=we(p.headers,"x-recaptcha-verified-at");if(f.includes("application/json")){let m=await p.json(),v=(m&&typeof m.sessionId=="string"&&m.sessionId.trim()?m.sessionId.trim():void 0)??c;return h&&v&&Z(v,h),m}return h&&c&&Z(c,h),await p.text()}async function bt(e,t,r,n,a,o,s){let u=globalThis.WpSuite?.plugins?.gatey;if(!u?.cognito?.post)throw new x("Gatey backend selected, but Gatey.cognito.post is not available.",a);let c=ye(s,o,r),g=await D(s,{...n.headers??{}},{cacheKey:c});K(n,{feature:o,context:s,step:"backend:request",source:"backend"}),K(n,{feature:o,context:s,step:"backend:waiting",source:"backend"});let l=u.cognito.post({apiName:e,path:t,options:{body:r,headers:g,retryStrategy:{strategy:"no-retry"}}});n?.signal?.addEventListener?.("abort",()=>{l.cancel()});let p=await l.response,f=we(p.headers,"x-recaptcha-verified-at"),h=await p.body.json(),m=h?.sessionId??c;return f&&typeof m=="string"&&m.trim()&&Z(m.trim(),f),K(n,{feature:o,context:s,step:"backend:response",source:"backend"}),h}var be,lt,gt,pt,Y=A(()=>{"use strict";J();be=new Map;lt={prompt:["text","systemPrompt","context","responseConstraint","saveChatSession","engine","sessionId","images","imageUrls","feedbackMessageId","feedbackType","knowledgeBaseId","disableKB","enableRerank","topK","temperature"],writer:["text","outputLanguage","instruction","context","tone","format","length","knowledgeBaseId","disableKB"],rewriter:["text","outputLanguage","instruction","context","tone","format","length"],summarizer:["text","outputLanguage","instruction","context","type","format","length"],translator:["text","sourceLanguage","targetLanguage"],"language-detector":["text","maxCandidates"],proofreader:["text","expectedInputLanguages"]};gt={prompt:"/admin/prompt",writer:"/admin/write",rewriter:"/admin/rewrite",summarizer:"/admin/summarize",translator:"/admin/translate","language-detector":"/admin/detect-language",proofreader:"/admin/proofread"},pt={prompt:"/frontend/prompt",writer:"/frontend/write",rewriter:"/frontend/rewrite",summarizer:"/frontend/summarize",translator:"/frontend/translate","language-detector":"/frontend/detect-language",proofreader:"/frontend/proofread"}});var Me={};V(Me,{detectLanguage:()=>It,getPromptOptions:()=>Be,getProofreadOptions:()=>Le,getRewriteOptions:()=>Se,getSummarizeOptions:()=>Te,getTranslateOptions:()=>Oe,getWriteOptions:()=>xe,prompt:()=>jt,proofread:()=>Kt,rewrite:()=>Mt,sendChatMessage:()=>Vt,sendFeedbackMessage:()=>$t,sendSearchMessage:()=>Gt,summarize:()=>Et,translate:()=>W,write:()=>Bt});import{getWpSuite as yt}from"@smart-cloud/wpsuite-core";function te(e){if(e==null)return String(e);if(typeof e!="object")return JSON.stringify(e);if(Array.isArray(e))return"["+e.map(te).join(",")+"]";let t=e;return"{"+Object.keys(t).sort().map(n=>JSON.stringify(n)+":"+te(t[n])).join(",")+"}"}function wt(e){let t=5381;for(let r=0;r<e.length;r++)t=t*33^e.charCodeAt(r);return(t>>>0).toString(36)}function ht(e,t){return`${e}:${wt(te(t))}`}function ee(){let e=new Map;for(let r of C.values()){let n=e.get(r.kind)??[];n.push(r),e.set(r.kind,n)}for(let[r,n]of e.entries())if(!(n.length<=Ce)){n.sort((a,o)=>a.refCount-o.refCount||a.lastUsed-o.lastUsed||a.key.localeCompare(o.key));for(let a of n){if(e.get(r).length<=Ce)break;if(!(a.refCount>0)){try{a.destroy()}catch{}C.delete(a.key),e.set(r,(e.get(r)??[]).filter(o=>o.key!==a.key))}}}if(C.size<=ke)return;let t=Array.from(C.values());t.sort((r,n)=>r.refCount-n.refCount||r.lastUsed-n.lastUsed||r.key.localeCompare(n.key));for(let r of t){if(C.size<=ke)break;if(!(r.refCount>0)){try{r.destroy()}catch{}C.delete(r.key)}}}async function T(e,t,r,n){let a=ht(e,t),o=C.get(a);if(o)return o.refCount++,o.lastUsed=Date.now(),C.delete(a),C.set(a,o),{model:o.model,fromCache:!0,release:()=>{let u=C.get(a);u&&(u.refCount=Math.max(0,u.refCount-1),u.lastUsed=Date.now(),ee())}};let s=U.get(a);if(s)return s;let i=(async()=>{let u=await r(),c={kind:e,key:a,model:u,refCount:1,lastUsed:Date.now(),destroy:()=>n(u)};return C.set(a,c),U.delete(a),ee(),{model:u,fromCache:!1,release:()=>{let g=C.get(a);g&&(g.refCount=Math.max(0,g.refCount-1),g.lastUsed=Date.now(),ee())}}})().catch(u=>{throw U.delete(a),u});return U.set(a,i),i}function P(){return(Ae?.plugins?.aiKit?.settings??{}).defaultOutputLanguage??"en"}function z(e){let t=["en","ja","es"],r=e.toLowerCase();return t.some(n=>r===n.toLowerCase())}function d(e,t,r,n){try{r?.onStatus?.({feature:e,context:t,...n})}catch{}}function I(){return Ae?.plugins?.aiKit?.settings?.sharedContext??void 0}function S(e){return e?.context??"admin"}function O(e,t=vt){let r=new AbortController,n=e?.signal,a=typeof e?.onDeviceTimeoutOverride=="number"?e.onDeviceTimeoutOverride:void 0,o=typeof a=="number"?a:t,s,i=!1,u=()=>{if(r.signal.aborted)return;let c=typeof n?.reason<"u"?n?.reason:void 0;r.abort(c??new DOMException("Aborted","AbortError"))};return n&&(n.aborted?u():n.addEventListener("abort",u)),o&&o>0&&(s=setTimeout(()=>{r.signal.aborted||(i=!0,r.abort(new re(o)))},o)),{signal:r.signal,timedOut:()=>i,dispose:()=>{s&&(clearTimeout(s),s=void 0),n&&n.removeEventListener("abort",u)}}}function j(e){let t=e;return{knowledgeBaseId:typeof t.knowledgeBaseId=="string"?t.knowledgeBaseId:void 0,disableKB:typeof t.disableKB=="boolean"?t.disableKB:void 0}}async function kt(e,t,r,n){let a=j(e),o=await Re(e.images,r,t,n);return{text:e.messages.filter(s=>s.role==="user").map(s=>s.content).join(`
`),systemPrompt:e.messages.filter(s=>s.role==="system").map(s=>s.content).join(`
`),images:o?.images,imageUrls:o?.imageUrls,context:e.sharedContext,saveChatSession:!1,responseConstraint:e.responseConstraint,...a}}async function Ct(e,t,r){let n=j(e),a=await Re(e.images,t,"frontend",r);return{sessionId:e.sessionId,text:e.message,images:a?.images,imageUrls:a?.imageUrls,context:e.sessionId?void 0:e.sharedContext,saveChatSession:!0,...n}}async function At(e){let t=j(e);return{engine:"kb_rag",sessionId:e.sessionId,text:e.query,topK:e.topK,context:e.sessionId?void 0:e.sharedContext,saveChatSession:!1,...t}}async function Pt(e){return{sessionId:e.sessionId,feedbackMessageId:e.feedbackMessageId,feedbackType:e.feedbackType,saveChatSession:!0}}function xt(e){let t=j(e);return{text:e.prompt,outputLanguage:e.outputLanguage,instruction:e.context?.trim()?e.context.trim():void 0,context:e.sharedContext,tone:e.tone,format:e.format,length:e.length,...t}}function St(e){return{text:e.text,outputLanguage:e.outputLanguage,instruction:e.context?.trim()?e.context.trim():void 0,context:e.sharedContext,tone:e.tone,format:e.format,length:e.length}}function Lt(e){return{text:e.text,outputLanguage:e.outputLanguage,instruction:e.context?.trim()?e.context.trim():void 0,context:e.sharedContext,type:e.type,format:e.format,length:e.length}}function Tt(e,t,r){return{text:e,sourceLanguage:t,targetLanguage:r}}function Ot(e,t){let r=t;return{text:e,maxCandidates:typeof r?.maxCandidates=="number"?r.maxCandidates:void 0}}function Rt(e){return{text:e.text,expectedInputLanguages:e.expectedInputLanguages}}async function R(e,t,r,n,a,o,s,i){d(n,e,i,{step:"decide",message:"Deciding capability",silent:r});let u=await q(n,a,t);if(d(n,e,i,{step:"decide",source:u.source,message:`Using ${u.source}`,silent:r}),u.source==="on-device")try{let c=await o();return d(n,e,i,{step:"done",source:"on-device",silent:r}),c}catch(c){console.error(`Error in on-device ${n}:`,c),d(n,e,i,{step:"error",source:"on-device",message:c.message,silent:r}),i?.signal?.throwIfAborted()}if(u.mode!=="local-only"&&u.backendAvailable){d(n,e,i,{step:"backend:request",source:"backend",silent:r});let c=typeof s=="function"?await s(u):s,g=await E(u,e,n,c,i);return d(n,e,i,{step:"done",source:"backend",silent:r}),g}throw new Error(`No capability for "${n}" (${e}). Reason: ${u.reason}`)}function Ft(e){let t=Array.isArray(e.images)&&e.images.length>0,r=e.images??[],n=t?r.map(o=>({type:"image",value:o})):[],a;if(typeof e.messages=="string")a=t?[{role:"user",content:[{type:"text",value:e.messages},...n]}]:e.messages;else{let o=e.messages.filter(s=>s.role!=="system").map(s=>({role:s.role==="assistant"?"assistant":"user",content:s.content}));if(t){let s=-1;for(let i=o.length-1;i>=0;i--)if(o[i].role==="user"){s=i;break}if(s===-1)o.push({role:"user",content:[{type:"text",value:""},...n]});else{let i=String(o[s].content??"");o[s]={...o[s],content:[{type:"text",value:i},...n]}}}a=o}return a}function Ut(e){return typeof Blob<"u"&&e instanceof Blob}function zt(e){let t=(e??"").toLowerCase();return t.includes("png")?"png":t.includes("webp")?"webp":t.includes("gif")?"gif":t.includes("bmp")?"bmp":"jpg"}function Wt(e){let t=(e??"").toLowerCase();return t.includes("png")?"png":t.includes("webp")?"webp":t.includes("gif")?"gif":"jpeg"}async function Nt(e){return new Promise((t,r)=>{let n=new FileReader;n.onerror=()=>r(n.error??new Error("FileReader error")),n.onload=()=>t(String(n.result??"")),n.readAsDataURL(e)})}async function _t(e){let t=await Nt(e),r=t.indexOf(",");return r>=0?t.substring(r+1):t}async function Ht(e,t,r,n,a,o){let s=t==="admin"?"/admin/generate-upload-url":"/frontend/generate-upload-url",i={...o?.headers??{}},u=await D(t,i);if(e.backendTransport==="fetch"){if(!e.backendBaseUrl)throw new Error("backendBaseUrl missing for fetch transport");let f=new URLSearchParams({fileName:r,contentType:n,contentLength:String(a)}).toString(),h=`${e.backendBaseUrl.replace(/\/+$/,"")}${s}?${f}`,m=await fetch(h,{method:"GET",headers:u,signal:o?.signal,credentials:"omit"});if(!m.ok){let F=await m.text().catch(()=>"");throw new Error(`generate-upload-url failed (fetch): HTTP ${m.status}${F?": "+F.substring(0,200):""}`)}let v=await m.json();if(!v?.uploadUrl||!v?.imageKey)throw new Error("generate-upload-url response missing uploadUrl/imageKey");return{uploadUrl:v.uploadUrl,imageKey:v.imageKey}}if(!e.backendApiName)throw new Error("backendApiName missing for gatey transport");let c=globalThis.WpSuite?.plugins?.gatey,g={fileName:r,contentType:n,contentLength:a};if(c?.cognito?.get){let f=c.cognito.get({apiName:e.backendApiName,path:s,options:{queryParams:Object.keys(g).reduce((m,v)=>(m[v]=String(g[v]),m),{}),headers:u,retryStrategy:{strategy:"no-retry"}}});o?.signal?.addEventListener?.("abort",()=>{f.cancel()});let h=await f.response.then(m=>m.body.json());if(!h?.uploadUrl||!h?.imageKey)throw new Error("generate-upload-url (gatey get) response missing uploadUrl/imageKey");return{uploadUrl:h.uploadUrl,imageKey:h.imageKey}}if(!c?.cognito?.post)throw new Error("Gatey.cognito.post is not available");let l=c.cognito.post({apiName:e.backendApiName,path:s,options:{body:g,headers:u,retryStrategy:{strategy:"no-retry"}}});o?.signal?.addEventListener?.("abort",()=>{l.cancel()});let p=await l.response.then(f=>f.body.json());if(!p?.uploadUrl||!p?.imageKey)throw new Error("generate-upload-url (gatey post) response missing uploadUrl/imageKey");return{uploadUrl:p.uploadUrl,imageKey:p.imageKey}}async function qt(e,t,r,n){let a=await fetch(e,{method:"PUT",headers:{"Content-Type":r||"application/octet-stream"},body:t,signal:n?.signal});if(!a.ok){let o=await a.text().catch(()=>"");throw new Error(`S3 upload failed: HTTP ${a.status}${o?": "+o.substring(0,200):""}`)}}async function Re(e,t,r,n){if(!e||e.length===0)return;let a=[];for(let c of e){if(!Ut(c))throw new Error("Backend multimodal prompting currently supports only Blob/File inputs for images.");a.push(c)}let o=a.reduce((c,g)=>c+(g.size||0),0);if(Math.ceil(o*1.37+2048*a.length)<=Dt){d("prompt",r,n,{step:"backend:request",source:"backend",message:"Inlining images as base64"});let c=[];for(let g of a)c.push({format:Wt(g.type),data:await _t(g)});return{images:c}}d("prompt",r,n,{step:"backend:request",source:"backend",message:"Uploading images via signed URL"});let u=[];for(let c=0;c<a.length;c++){let g=a[c],l=g.type||"application/octet-stream",p=g.name||`image_${c}.${zt(l)}`;d("prompt",r,n,{step:"backend:request",source:"backend",message:"Requesting signed URL"});let{uploadUrl:f,imageKey:h}=await Ht(t,r,p,l,g.size||0,n);d("prompt",r,n,{step:"backend:waiting",source:"backend",message:"Uploading"}),await qt(f,g,l,n),u.push(h)}return{imageUrls:u}}var ke,Ce,C,U,Ae,vt,Pe,re,xe,Bt,Se,Mt,Le,Kt,Te,Et,It,Oe,W,Dt,Be,jt,Vt,Gt,$t,Ke=A(()=>{"use strict";Y();Q();Ie();ke=8,Ce=2,C=new Map,U=new Map;typeof window<"u"&&window.addEventListener("beforeunload",()=>{for(let e of C.values())try{e.destroy()}catch{}C.clear(),U.clear()});Ae=yt();vt=45e3,Pe=5e3,re=class extends Error{timeoutMs;constructor(t){super(`On-device execution exceeded ${t}ms`),this.name="OnDeviceTimeoutError",this.timeoutMs=t}};xe=e=>{let t=e.outputLanguage?e.outputLanguage:P(),r={tone:e.tone,format:e.format,length:e.length,outputLanguage:t};return Promise.resolve(r)},Bt=async(e,t)=>{let r=S(t),n=e.sharedContext??I(),a=e.outputLanguage?e.outputLanguage:P(),o=a,s=!1;z(a)||(s=!0,a="en");let i=xe({...e,outputLanguage:a});return R(r,t?.modeOverride,!1,"writer",i,async()=>{if(typeof Writer>"u")throw new Error("Writer API not available in this browser.");d("writer",r,t,{step:"on-device:init",source:"on-device",message:"Creating Writer session"});let u=O(t);try{let{model:c,release:g}=await T("writer",{core:i,sharedContext:n},()=>Writer.create({...i,sharedContext:n,monitor(l){l.addEventListener("downloadprogress",p=>{let f=p.loaded;d("writer",r,t,{step:"on-device:download",source:"on-device",progress:f,loaded:f})})}}),l=>l.destroy());d("writer",r,t,{step:"on-device:ready",source:"on-device"});try{d("writer",r,t,{step:"on-device:run",source:"on-device",message:"Generating text"});let l=await c.write(e.prompt,{context:e.context,signal:u.signal});return s?{result:(await W({text:l,sourceLanguage:a,targetLanguage:o},{context:r,signal:u.signal})).result}:{result:l}}finally{try{g()}catch(l){console.error("Error destroying writer:",l)}}}finally{u.dispose()}},xt({...e,sharedContext:n,outputLanguage:o}),t)},Se=e=>{let t=e.outputLanguage?e.outputLanguage:P(),r={tone:e.tone,format:e.format,length:e.length,outputLanguage:t};return Promise.resolve(r)},Mt=async(e,t)=>{let r=S(t),n=e.sharedContext??I(),a=e.outputLanguage?e.outputLanguage:P(),o=a,s=!1;z(a)||(s=!0,a="en");let i=Se({...e,outputLanguage:a});return R(r,t?.modeOverride,!1,"rewriter",i,async()=>{if(typeof Rewriter>"u")throw new Error("Rewriter API not available in this browser.");d("rewriter",r,t,{step:"on-device:init",source:"on-device",message:"Creating Rewriter session"});let u=O(t);try{let{model:c,release:g}=await T("rewriter",{core:i,sharedContext:n},()=>Rewriter.create({...i,sharedContext:n,monitor(l){l.addEventListener("downloadprogress",p=>{let f=p.loaded;d("rewriter",r,t,{step:"on-device:download",source:"on-device",progress:f,loaded:f})})}}),l=>l.destroy());d("rewriter",r,t,{step:"on-device:ready",source:"on-device"});try{d("rewriter",r,t,{step:"on-device:run",source:"on-device",message:"Rewriting text"});let l=await c.rewrite(e.text,{context:e.context,signal:u.signal});return s?{result:(await W({text:l,sourceLanguage:a,targetLanguage:o},{context:r,signal:u.signal})).result}:{result:l}}finally{try{g()}catch(l){console.error("Error destroying rewriter:",l)}}}finally{u.dispose()}},St({...e,sharedContext:n,outputLanguage:o}),t)},Le=()=>Promise.resolve({includeCorrectionTypes:!0,includeCorrectionExplanations:!0}),Kt=async(e,t)=>{let r=S(t),n=await Le();return R(r,t?.modeOverride,!1,"proofreader",n,async()=>{if(typeof Proofreader>"u")throw new Error("Proofreader API not available in this browser.");d("proofreader",r,t,{step:"on-device:init",source:"on-device",message:"Creating Proofreader session"});let a=O(t);try{let{model:o,release:s}=await T("proofreader",{core:n},()=>Proofreader.create({...n,monitor(i){i.addEventListener("downloadprogress",u=>{let c=u.loaded;d("proofreader",r,t,{step:"on-device:download",source:"on-device",progress:c,loaded:c})})}}),i=>i.destroy());d("proofreader",r,t,{step:"on-device:ready",source:"on-device"});try{return d("proofreader",r,t,{step:"on-device:run",source:"on-device",message:"Proofreading"}),{result:await o.proofread(e.text,{signal:a.signal})}}finally{try{s()}catch(i){console.error("Error destroying proofreader:",i)}}}finally{a.dispose()}},Rt(e),t)},Te=e=>{let t=e.outputLanguage?e.outputLanguage:P(),r={type:e.type,format:e.format,length:e.length,outputLanguage:t};return Promise.resolve(r)},Et=async(e,t)=>{let r=S(t),n=e.sharedContext??I(),a=e.outputLanguage?e.outputLanguage:P(),o=a,s=!1;z(a)||(s=!0,a="en");let i=await Te({...e,outputLanguage:a});return R(r,t?.modeOverride,!1,"summarizer",i,async()=>{if(typeof Summarizer>"u")throw new Error("Summarizer API not available in this browser.");d("summarizer",r,t,{step:"on-device:init",source:"on-device",message:"Creating Summarizer session"});let u=O(t);try{let{model:c,release:g}=await T("summarizer",{core:i,sharedContext:n},()=>Summarizer.create({...i,sharedContext:n,monitor(l){l.addEventListener("downloadprogress",p=>{let f=p.loaded;d("summarizer",r,t,{step:"on-device:download",source:"on-device",progress:f,loaded:f})})}}),l=>l.destroy());d("summarizer",r,t,{step:"on-device:ready",source:"on-device"});try{d("summarizer",r,t,{step:"on-device:run",source:"on-device",message:"Summarizing"});let l=await c.summarize(e.text,{context:e.context,signal:u.signal});return s?{result:(await W({text:l,sourceLanguage:a,targetLanguage:o},{context:r,signal:u.signal})).result}:{result:l}}finally{try{g()}catch(l){console.error("Error destroying summarizer:",l)}}}finally{u.dispose()}},Lt({...e,sharedContext:n,outputLanguage:o}),t)},It=async(e,t)=>{let r=S(t);return R(r,t?.modeOverride,t?.silent,"language-detector",void 0,async()=>{if(typeof LanguageDetector>"u")throw new Error("LanguageDetector API not available in this browser.");d("language-detector",r,t,{step:"on-device:init",source:"on-device",message:"Creating LanguageDetector session",silent:t?.silent});let n=O(t,Pe);try{let{model:a,release:o}=await T("language-detector",{},()=>LanguageDetector.create({monitor(s){s.addEventListener("downloadprogress",i=>{let u=i.loaded;d("language-detector",r,t,{step:"on-device:download",source:"on-device",progress:u,loaded:u,silent:t?.silent})})}}),s=>s.destroy());d("language-detector",r,t,{step:"on-device:ready",source:"on-device",silent:t?.silent});try{return d("language-detector",r,t,{step:"on-device:run",source:"on-device",message:"Detecting language",silent:t?.silent}),{result:{candidates:(await a.detect(e.text,{signal:n.signal})).filter(i=>Ee.find(u=>u.value===i.detectedLanguage))}}}finally{try{o()}catch(s){console.error("Error destroying language detector:",s)}}}finally{n.dispose()}},Ot(e.text,t),t)},Oe=e=>{let t={sourceLanguage:e.sourceLanguage??"auto",targetLanguage:e.targetLanguage??P()??"en"};return Promise.resolve(t)},W=async(e,t)=>{let r=S(t),n=await Oe({...e});return R(r,t?.modeOverride,t?.silent,"translator",n,async()=>{if(typeof Translator>"u")throw new Error("Translator API not available in this browser.");d("translator",r,t,{step:"on-device:init",source:"on-device",message:"Creating Translator session",silent:t?.silent});let a=O(t,Pe);try{let{model:o,release:s}=await T("translator",{core:n},()=>Translator.create({...n,monitor(i){i.addEventListener("downloadprogress",u=>{let c=u.loaded;d("translator",r,t,{step:"on-device:download",source:"on-device",progress:c,loaded:c,silent:t?.silent})})}}),i=>i.destroy());d("translator",r,t,{step:"on-device:ready",source:"on-device",silent:t?.silent});try{d("translator",r,t,{step:"on-device:run",source:"on-device",message:"Translating",silent:t?.silent});let i=[],u=()=>{if(typeof a.signal.throwIfAborted=="function")a.signal.throwIfAborted();else if(a.signal.aborted)throw a.signal.reason??new DOMException("Aborted","AbortError")};for(let g of e.text.split(`
`))u(),i.push(o.translate(g.trim()));return{result:(await Promise.all(i)).join(`
`)}}finally{try{s()}catch(i){console.error("Error destroying translator:",i)}}}finally{a.dispose()}},Tt(e.text,e.sourceLanguage,e.targetLanguage),t)};Dt=4*1024*1024;Be=async e=>{let t=e.outputLanguage?e.outputLanguage:P();return z(t)||(t="en"),{topK:e.topK,temperature:e.temperature,expectedInputs:[{type:"text"},{type:"image"}],expectedOutputs:[{type:"text",languages:[t]}]}},jt=async(e,t)=>{let r=S(t),n=e.sharedContext??I(),a=e.outputLanguage?e.outputLanguage:P(),o=a,s=!1;z(a)||(s=!0,a="en");let i=await Be({...e,outputLanguage:a}),u=await q("prompt",i,t?.modeOverride);return R(r,t?.modeOverride,!1,"prompt",i,async()=>{if(typeof LanguageModel>"u")throw new Error("LanguageModel API not available in this browser.");d("prompt",r,t,{step:"on-device:init",source:"on-device",message:"Creating LanguageModel session"});let c=[];if(typeof e.messages!="string"){for(let f of e.messages)f.role==="system"&&f.content.trim()&&c.push(f.content.trim());n&&n.trim()&&c.push("SHARED CONTEXT: "+n.trim())}let g=c.length>0?c.join(`

`):void 0,l=g?[{role:"system",content:g}]:void 0,p=O(t);try{let{model:f,release:h}=await T("language-model",{core:i,initialPrompts:l},()=>LanguageModel.create({...i,initialPrompts:l,monitor(m){m.addEventListener("downloadprogress",v=>{let F=v.loaded;d("prompt",r,t,{step:"on-device:download",source:"on-device",progress:F,loaded:F})})}}),m=>m.destroy());d("prompt",r,t,{step:"on-device:ready",source:"on-device"});try{d("prompt",r,t,{step:"on-device:run",source:"on-device",message:"Generating text"});let m=await f.prompt(Ft(e),{signal:p.signal,responseConstraint:e.responseConstraint});return s?{result:(await W({text:m,sourceLanguage:a,targetLanguage:o},{context:r,signal:p.signal})).result}:{result:m}}finally{try{h()}catch(m){console.error("Error destroying LanguageModel:",m)}}}finally{p.dispose()}},await kt({...e,sharedContext:n},r,u,t),t)},Vt=async(e,t)=>{let r="frontend",n=e.sharedContext??I(),a="prompt",o=await M(),s={feature:a,mode:"backend-only",onDeviceAvailable:!1,backendAvailable:o.available,backendTransport:o.transport,backendApiName:o.apiName,backendBaseUrl:o.baseUrl,backendReason:o.reason},i=await Ct({sessionId:e.sessionId,message:e.message,images:e.images,sharedContext:n},s,t);d(a,r,t,{step:"backend:request",source:"backend"});let u=await E(s,r,a,i,t);return d(a,r,t,{step:"done",source:"backend"}),u},Gt=async(e,t)=>{let r=S(t),n=e.sharedContext??I(),a="prompt",o=await M(),s={feature:a,mode:"backend-only",onDeviceAvailable:!1,backendAvailable:o.available,backendTransport:o.transport,backendApiName:o.apiName,backendBaseUrl:o.baseUrl,backendReason:o.reason},i=await At({query:e.query,topK:e.topK,sessionId:e.sessionId,sharedContext:n,knowledgeBaseId:e.knowledgeBaseId});d(a,r,t,{step:"backend:request",source:"backend"});let u=await E(s,r,a,i,t);return d(a,r,t,{step:"done",source:"backend"}),u},$t=async(e,t)=>{let r="frontend",n="prompt",a=await M(),o={feature:n,mode:"backend-only",onDeviceAvailable:!1,backendAvailable:a.available,backendTransport:a.transport,backendApiName:a.apiName,backendBaseUrl:a.baseUrl,backendReason:a.reason},s=await Pt({sessionId:e.sessionId,feedbackMessageId:e.feedbackMessageId,feedbackType:e.feedbackType});d(n,r,t,{step:"backend:request",source:"backend"});let i=await E(o,r,n,s,t);return d(n,r,t,{step:"done",source:"backend"}),i}});import{attachDefaultPluginRuntime as Xt}from"@smart-cloud/wpsuite-core";import{__ as w}from"@wordpress/i18n";var Ee,ne,xr,Sr,Lr,Jt,Tr,b,Or,Rr,Br,Mr,Kr,Er,Ir,Fr,Dr,Ur,zr,Wr,Nr,_r,Hr,qr,jr,Ie=A(()=>{G();_();ue();_();ce();J();Ee=[{label:w("Arabic",y),value:"ar"},{label:w("Chinese",y),value:"zh"},{label:w("Dutch",y),value:"nl"},{label:w("English",y),value:"en"},{label:w("French",y),value:"fr"},{label:w("German",y),value:"de"},{label:w("Hebrew",y),value:"he"},{label:w("Hindi",y),value:"hi"},{label:w("Hungarian",y),value:"hu"},{label:w("Indonesian",y),value:"id"},{label:w("Italian",y),value:"it"},{label:w("Japanese",y),value:"ja"},{label:w("Korean",y),value:"ko"},{label:w("Norwegian",y),value:"no"},{label:w("Polish",y),value:"pl"},{label:w("Portuguese",y),value:"pt"},{label:w("Russian",y),value:"ru"},{label:w("Spanish",y),value:"es"},{label:w("Swedish",y),value:"sv"},{label:w("Thai",y),value:"th"},{label:w("Turkish",y),value:"tr"},{label:w("Ukrainian",y),value:"uk"}],ne=Promise.resolve().then(()=>(Q(),fe)),xr=async()=>(await ne).MIN_CHROME_VERSION,Sr=async(...e)=>(await ne).decideCapability(...e),Lr=async(...e)=>(await ne).checkOnDeviceAvailability(...e),Jt=Promise.resolve().then(()=>(Y(),ve)),Tr=async(...e)=>(await Jt).dispatchBackend(...e),b=Promise.resolve().then(()=>(Ke(),Me)),Or=async(...e)=>(await b).getWriteOptions(...e),Rr=async(...e)=>(await b).write(...e),Br=async(...e)=>(await b).getRewriteOptions(...e),Mr=async(...e)=>(await b).rewrite(...e),Kr=async(...e)=>(await b).getProofreadOptions(...e),Er=async(...e)=>(await b).proofread(...e),Ir=async(...e)=>(await b).getSummarizeOptions(...e),Fr=async(...e)=>(await b).summarize(...e),Dr=async(...e)=>(await b).getTranslateOptions(...e),Ur=async(...e)=>(await b).translate(...e),zr=async(...e)=>(await b).detectLanguage(...e),Wr=async(...e)=>(await b).getPromptOptions(...e),Nr=async(...e)=>(await b).prompt(...e),_r=async(...e)=>(await b).sendChatMessage(...e),Hr=async(...e)=>(await b).sendFeedbackMessage(...e),qr=async(...e)=>(await b).sendSearchMessage(...e),jr=(e,t)=>{let r=globalThis.WpSuite,n=B();if(!n)throw console.error("AiKit plugin is not available"),new Error("AiKit plugin is not available");Xt(n),n.status=n.status??"initializing";let a=ie();return n.features={store:a,renderFeature:async o=>await e({...o,store:await a}),renderSearchComponent:async o=>{if(!t)throw new Error("renderSearchComponent is not configured");return await t({...o,store:await a})},write:async(...o)=>{let s=await b,i=o[1]||{};return o[1]={context:"frontend",...i},s.write(...o)},rewrite:async(...o)=>{let s=await b,i=o[1]||{};return o[1]={context:"frontend",...i},s.rewrite(...o)},proofread:async(...o)=>{let s=await b,i=o[1]||{};return o[1]={context:"frontend",...i},s.proofread(...o)},summarize:async(...o)=>{let s=await b,i=o[1]||{};return o[1]={context:"frontend",...i},s.summarize(...o)},translate:async(...o)=>{let s=await b,i=o[1]||{};return o[1]={context:"frontend",...i},s.translate(...o)},detectLanguage:async(...o)=>{let s=await b,i=o[1]||{};return o[1]={context:"frontend",...i},s.detectLanguage(...o)},prompt:async(...o)=>{let s=await b,i=o[1]||{};return o[1]={context:"frontend",...i},s.prompt(...o)},sendChatMessage:async(...o)=>(await b).sendChatMessage(...o),sendFeedbackMessage:async(...o)=>(await b).sendFeedbackMessage(...o),sendSearchMessage:async(...o)=>(await b).sendSearchMessage(...o)},a.then(()=>{n.status="available",r?.events?.emit("wpsuite:ai-kit:ready",{key:n.key,version:n.version})}).catch(o=>{n.status="error",console.error("AiKit plugin failed to initialize:",o),r?.events?.emit("wpsuite:ai-kit:error",{key:n.key,error:String(o)})}),n}});Ie();export{ir as AiKitChatbotIcon,ur as AiKitDocSearchIcon,sr as AiKitFeatureIcon,x as BackendError,Ee as LANGUAGE_OPTIONS,y as TEXT_DOMAIN,Lr as checkOnDeviceAvailability,Sr as decideCapability,zr as detectLanguage,Tr as dispatchBackend,B as getAiKitPlugin,xr as getMinChromeVersions,Wr as getPromptOptions,Kr as getProofreadOptions,Br as getRewriteOptions,De as getStore,Xe as getStoreDispatch,N as getStoreSelect,Ir as getSummarizeOptions,Dr as getTranslateOptions,Or as getWriteOptions,jr as initializeAiKit,Je as observeStore,Nr as prompt,Er as proofread,Mr as rewrite,se as sanitizeAiKitConfig,_r as sendChatMessage,Hr as sendFeedbackMessage,qr as sendSearchMessage,Fr as summarize,Ur as translate,ae as waitForAiKitReady,Rr as write};
