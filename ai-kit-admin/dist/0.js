"use strict";(globalThis.webpackChunk_smart_cloud_ai_kit_admin=globalThis.webpackChunk_smart_cloud_ai_kit_admin||[]).push([[0],{8e3(e,t,a){a.r(t),a.d(t,{default:()=>y});var l=a(8790),o=a(4200),s=a(1139),i=a(7641),r=a(899),n=a(3),c=a(9208),h=a(2449),d=a(4225),u=a(7143),b=a(7723),x=a(1609),m=a(7391),g=a(3226),p=a(3514),v=a(790);m.F.putVocabularies(s.P9);const j=["userLabel","assistantLabel","sendLabel","cancelLabel","resetLabel","confirmLabel","clickAgainToConfirmLabel","notSentLabel","editLabel","readyLabel","readyEmptyLabel","addLabel","addImageLabel","removeImageLabel","closeChatLabel","maximizeLabel","restoreSizeLabel","referencesLabel","referenceLabel","acceptResponseLabel","rejectResponseLabel","emptyResponseLabel","unexpectedErrorLabel"];function y({apiUrl:e,config:t,accountId:a,siteId:y,siteKey:f,onSave:T,InfoLabelComponent:C,store:S}){const[I,k]=(0,x.useState)(!1),w=(0,u.useSelect)(()=>(0,o.mI)(S).isShowChatbotPreview(),[S]),F=(0,u.useSelect)(()=>(0,o.mI)(S).getCustomTranslations(),[S]),L=(0,l.useForm)({initialValues:{enableChatbot:!!t?.enableChatbot,chatbot:t?.chatbot??{},labels:t?.chatbot?.labels??{}}});(0,x.useEffect)(()=>{m.F.putVocabularies(F||{})},[F]),(0,x.useEffect)(()=>{t&&(L.setValues({enableChatbot:!!t.enableChatbot,chatbot:t.chatbot??{},labels:t.chatbot?.labels??{}}),m.F.setLanguage(t.chatbot?.language??""))},[t]);const V=(0,x.useMemo)(()=>({...t?.chatbot??{},...L.values.chatbot??{},labels:L.values.labels,previewMode:!0}),[t,L.values.chatbot,L.values.labels]),A=(0,x.useCallback)(async s=>{if(a&&y&&f){k(!0);try{const i={...{...t,enableChatbot:s.enableChatbot,chatbot:{...t.chatbot??{},...s.chatbot??{},labels:s.labels}}};delete i.subscriptionType;const n=await(0,p.D)(e,a,y,f,i);T(n),l.notifications.show({title:(0,b.__)("Settings saved",o.Xg),message:(0,b.__)("Chatbot settings saved successfully.",o.Xg),color:"green",icon:(0,v.jsx)(r.A,{}),className:g.A.notification})}catch(e){l.notifications.show({title:(0,b.__)("Error occured",o.Xg),message:e.message,color:"red",icon:(0,v.jsx)(i.A,{}),className:g.A.notification})}finally{k(!1)}}},[a,y,f,t,e,T]),B=Object.entries(L.values.labels??{}).filter(([,e])=>"string"==typeof e),[O,z]=(0,x.useState)(null),[G,N]=(0,x.useState)(""),_=j.filter(e=>!(e in(L.values.labels??{}))).map(e=>({value:e,label:`${m.F.get(s.WG[e])} (${e})`})).sort((e,t)=>e.label.localeCompare(t.label)),D=Array.from({length:10},(e,t)=>({value:String(t),label:String(t)})),M=(0,x.useMemo)(()=>{const e=L.values.chatbot?.colors;return e&&"object"==typeof e?e:{}},[L.values.chatbot]),P=(0,x.useMemo)(()=>Object.entries(M).filter(([e,t])=>"string"==typeof e&&"string"==typeof t).sort(([e],[t])=>e.localeCompare(t)),[M]),E=(0,x.useMemo)(()=>{const e=Object.keys(l.DEFAULT_THEME.colors),t=Object.keys(M);return[...e,...t].filter((e,t,a)=>a.indexOf(e)===t).map(t=>({value:t,label:e.includes(t)?t:`${t} (custom)`}))},[M]),W=L.values.chatbot?.primaryShade,H="number"==typeof W?{light:W,dark:W}:{light:"number"==typeof W?.light?W.light:6,dark:"number"==typeof W?.dark?W.dark:8},R=H.light,$=H.dark,[U,X]=(0,x.useState)(""),[K,q]=(0,x.useState)("#228be6");return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("form",{name:"chatbotsettings-editor",onSubmit:L.onSubmit(A),style:{maxWidth:900},children:(0,v.jsxs)(l.Stack,{gap:"md",children:[(0,v.jsx)(l.Card,{withBorder:!0,shadow:"sm",children:(0,v.jsxs)(l.Stack,{gap:"md",children:[(0,v.jsxs)(l.Group,{align:"flex-start",justify:"space-between",children:[(0,v.jsxs)("div",{children:[(0,v.jsx)(l.Title,{order:4,children:"Chatbot configuration"}),(0,v.jsx)(l.Text,{size:"sm",c:"dimmed",children:"Enable/disable the chatbot, customize UI behavior and labels."})]}),(0,v.jsx)(l.Switch,{checked:w,onChange:e=>(0,o.Qk)(S).setShowChatbotPreview(e.currentTarget.checked),onLabel:(0,v.jsx)(c.A,{size:14}),offLabel:(0,v.jsx)(n.A,{size:14}),label:(0,v.jsx)(C,{text:"Preview",scrollToId:"chatbot-preview"})})]}),(0,v.jsx)(l.Switch,{label:(0,v.jsx)(C,{text:"Enable chatbot",scrollToId:"chatbot-enable"}),checked:L.values.enableChatbot,onChange:e=>L.setFieldValue("enableChatbot",e.currentTarget.checked)}),(0,v.jsx)(l.Divider,{}),(0,v.jsxs)(l.SimpleGrid,{cols:{base:1,sm:2},spacing:"md",verticalSpacing:"md",children:[(0,v.jsx)(l.TextInput,{label:(0,v.jsx)(C,{text:"Chat title",scrollToId:"chatbot-title"}),description:"Title shown at the top of the chat modal.",placeholder:m.F.get(s.WG.modalTitle),value:L.values.chatbot.title??"",onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,title:e.currentTarget.value})}),(0,v.jsx)(l.TextInput,{label:(0,v.jsx)(C,{text:"Placeholder",scrollToId:"chatbot-placeholder"}),description:"Input placeholder text shown above the message box.",placeholder:m.F.get(s.WG.placeholder),value:L.values.chatbot.placeholder??"",onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,placeholder:e.currentTarget.value})}),(0,v.jsx)(l.Select,{searchable:!0,clearable:!0,label:(0,v.jsx)(C,{text:"Language",scrollToId:"chatbot-language"}),description:"UI language for the chatbot. Leave empty to use defaults.",data:[{value:"",label:"--- Select ---"},...o.mN],value:L.values.chatbot.language??"",onChange:e=>{m.F.setLanguage(e??""),L.setFieldValue("chatbot",{...L.values.chatbot,language:e||void 0})}}),(0,v.jsx)(l.Select,{label:(0,v.jsx)(C,{text:"Direction",scrollToId:"chatbot-direction"}),description:'Text direction. "auto" follows the document direction.',data:[{value:"auto",label:"Auto"},{value:"ltr",label:"LTR"},{value:"rtl",label:"RTL"}],value:L.values.chatbot.direction??"auto",onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,direction:e??"auto"})}),(0,v.jsx)(l.Select,{label:(0,v.jsx)(C,{text:"History storage",scrollToId:"chatbot-history-storage"}),description:"Where to persist chat history (cleared after the retention window).",data:[{value:"localstorage",label:"Local storage (default)"},{value:"sessionstorage",label:"Session storage"},{value:"nostorage",label:"No storage"}],value:L.values.chatbot.historyStorage??"localstorage",onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,historyStorage:e??"localstorage"})}),(0,v.jsx)(l.NumberInput,{label:(0,v.jsx)(C,{text:"History retention",scrollToId:"chatbot-history-retention"}),description:"Days to keep chat history/messages locally. Default: 1.",placeholder:"e.g. 1",min:1,step:1,allowNegative:!1,allowDecimal:!1,value:"number"==typeof L.values.chatbot?.emptyHistoryAfterDays?L.values.chatbot.emptyHistoryAfterDays:void 0,onChange:e=>{const t="number"==typeof e&&Number.isFinite(e)&&e>=1?Math.trunc(e):void 0;L.setFieldValue("chatbot",{...L.values.chatbot,emptyHistoryAfterDays:t})}})]})]})}),(0,v.jsx)(l.Card,{withBorder:!0,shadow:"sm",children:(0,v.jsxs)(l.Stack,{gap:"md",children:[(0,v.jsxs)("div",{children:[(0,v.jsx)(l.Title,{order:4,children:"Advanced"}),(0,v.jsx)(l.Text,{size:"sm",c:"dimmed",children:"Optional layout and limits."})]}),(0,v.jsxs)(l.SimpleGrid,{cols:{base:1,sm:2},spacing:"md",verticalSpacing:"md",children:[(0,v.jsx)(l.Select,{label:(0,v.jsx)(C,{text:"Open button position",scrollToId:"chatbot-openbutton-position"}),description:"Where the open button is placed on the page.",data:[{value:"bottom-right",label:"Bottom right"},{value:"bottom-left",label:"Bottom left"},{value:"top-right",label:"Top right"},{value:"top-left",label:"Top left"}],value:L.values.chatbot.openButtonPosition??"bottom-right",onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,openButtonPosition:e??"bottom-right"})}),(0,v.jsx)(l.TextInput,{label:(0,v.jsx)(C,{text:"Open button label",scrollToId:"chatbot-openbutton-label"}),description:"Label shown on the open button.",value:L.values.chatbot.openButtonTitle??"",placeholder:m.F.get(s.WG.askMeLabel),onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,openButtonTitle:e.currentTarget.value})}),(0,v.jsx)(l.Select,{label:(0,v.jsx)(C,{text:"Open button icon layout",scrollToId:"chatbot-openbutton-icon-layout"}),description:"Icon position relative to the title.",data:[{value:"top",label:"Top"},{value:"bottom",label:"Bottom"},{value:"left",label:"Left"},{value:"right",label:"Right"}],value:L.values.chatbot.openButtonIconLayout??"top",onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,openButtonIconLayout:e??"top"})}),(0,v.jsx)(l.TextInput,{label:(0,v.jsx)(C,{text:"Open button icon (base64)",scrollToId:"chatbot-openbutton-icon"}),description:"Data URL (e.g. data:image/svg+xml;base64,...)",value:L.values.chatbot.openButtonIcon??"",onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,openButtonIcon:e.currentTarget.value})})]}),(0,v.jsxs)(l.Group,{mt:"md",gap:"xl",align:"center",children:[(0,v.jsx)(l.Switch,{label:(0,v.jsx)(C,{text:"Show open button title",scrollToId:"chatbot-openbutton-show-title"}),description:"Toggle the title visibility on the open button.",checked:L.values.chatbot.showOpenButtonTitle??!0,onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,showOpenButtonTitle:e.currentTarget.checked})}),(0,v.jsx)(l.Switch,{label:(0,v.jsx)(C,{text:"Show open button icon",scrollToId:"chatbot-openbutton-show-icon"}),description:"Toggle the icon visibility on the open button.",checked:L.values.chatbot.showOpenButtonIcon??!0,onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,showOpenButtonIcon:e.currentTarget.checked})})]}),(0,v.jsxs)(l.SimpleGrid,{cols:{base:1,sm:2},spacing:"md",verticalSpacing:"md",children:[(0,v.jsx)(l.NumberInput,{label:(0,v.jsx)(C,{text:"Max images",scrollToId:"chatbot-max-images"}),placeholder:"e.g. 3",min:0,value:L.values.chatbot?.maxImages??void 0,onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,maxImages:"number"==typeof e?e:void 0})}),(0,v.jsx)(l.NumberInput,{label:(0,v.jsx)(C,{text:"Max image bytes",scrollToId:"chatbot-max-image-bytes"}),placeholder:"e.g. 2000000",min:0,value:L.values.chatbot?.maxImageBytes??void 0,onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,maxImageBytes:"number"==typeof e?e:void 0})})]})]})}),(0,v.jsx)(l.Card,{withBorder:!0,shadow:"sm",children:(0,v.jsxs)(l.Stack,{gap:"md",children:[(0,v.jsxs)("div",{children:[(0,v.jsx)(l.Title,{order:4,children:(0,v.jsx)(C,{text:"Label overrides",scrollToId:"chatbot-label-overrides"})}),(0,v.jsx)(l.Text,{size:"sm",c:"dimmed",children:"Only the overridden labels are stored. Remove an override to fall back to defaults."})]}),0===B.length&&(0,v.jsx)(l.Text,{size:"sm",c:"dimmed",children:"No overrides yet."}),B.map(([e,t])=>(0,v.jsxs)(l.Group,{align:"flex-end",children:[(0,v.jsx)(l.TextInput,{label:`${m.F.get(s.WG[e])} (${e})`,value:t,placeholder:m.F.get(s.WG[e]),onChange:t=>{L.setFieldValue("labels",{...L.values.labels??{},[e]:t.target.value})},style:{flex:1}}),(0,v.jsx)(l.ActionIcon,{color:"red",variant:"light",onClick:()=>{const t={...L.values.labels??{}};delete t[e],L.setFieldValue("labels",t)},children:(0,v.jsx)(d.A,{size:16})})]},e)),(0,v.jsx)(l.Divider,{}),(0,v.jsxs)(l.Group,{align:"flex-end",children:[(0,v.jsx)(l.Select,{label:"Add label",data:_,value:O,onChange:z,placeholder:"Select key",style:{flex:1}}),(0,v.jsx)(l.TextInput,{label:"Text",value:G,onChange:e=>N(e.target.value),placeholder:m.F.get(s.WG[O]),style:{flex:2}}),(0,v.jsx)(l.Button,{leftSection:(0,v.jsx)(h.A,{size:16}),onClick:()=>{O&&(L.setFieldValue("labels",{...L.values.labels??{},[O]:G}),z(null),N(""))},children:"Add"})]})]})}),(0,v.jsx)(l.Card,{withBorder:!0,shadow:"sm",children:(0,v.jsxs)(l.Stack,{gap:"md",children:[(0,v.jsxs)("div",{children:[(0,v.jsx)(l.Title,{order:4,children:"Theme"}),(0,v.jsx)(l.Text,{size:"sm",c:"dimmed",children:"Customize Mantine theme settings used by the chatbot."})]}),(0,v.jsxs)(l.SimpleGrid,{cols:{base:1,sm:2},spacing:"md",verticalSpacing:"md",children:[(0,v.jsx)(l.Select,{label:(0,v.jsx)(C,{text:"Color mode",scrollToId:"chatbot-color-mode"}),description:'Theme mode. "auto" follows the site.',data:[{value:"auto",label:"Auto"},{value:"light",label:"Light"},{value:"dark",label:"Dark"}],value:L.values.chatbot.colorMode??"auto",onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,colorMode:e??"auto"})}),(0,v.jsx)(l.Select,{searchable:!0,clearable:!0,label:(0,v.jsx)(C,{text:"Primary color",scrollToId:"chatbot-primary-color"}),placeholder:"Select theme color",description:"Primary color used in the chatbot UI.",data:E,value:L.values.chatbot?.primaryColor??null,onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,...e?{primaryColor:e}:{primaryColor:void 0}})}),(0,v.jsxs)(l.Group,{grow:!0,align:"flex-start",children:[(0,v.jsx)(l.Select,{label:(0,v.jsx)(C,{text:"Primary shade (light)",scrollToId:"chatbot-primary-shade-light"}),data:D,value:String(R),description:"Shade used in light mode.",onChange:e=>{const t=Number.parseInt(e??"6",10);L.setFieldValue("chatbot",{...L.values.chatbot,primaryShade:{light:Number.isFinite(t)?t:6,dark:$}})}}),(0,v.jsx)(l.Select,{label:(0,v.jsx)(C,{text:"Primary shade (dark)",scrollToId:"chatbot-primary-shade-dark"}),data:D,value:String($),description:"Shade used in dark mode.",onChange:e=>{const t=Number.parseInt(e??"8",10);L.setFieldValue("chatbot",{...L.values.chatbot,primaryShade:{light:R,dark:Number.isFinite(t)?t:8}})}})]})]}),(0,v.jsx)(l.Textarea,{label:(0,v.jsx)(C,{text:"Theme Overrides",scrollToId:"chatbot-theme-overrides"}),description:"Optional scoped CSS for the chatbot root (great for overriding design tokens).",placeholder:":host, #ai-kit-inline-root, #ai-kit-portal-root { --ai-kit-chat-border-radius: 8px; }",minRows:4,value:L.values.chatbot?.themeOverrides??"",resize:"vertical",onChange:e=>L.setFieldValue("chatbot",{...L.values.chatbot,themeOverrides:e.currentTarget.value})}),(0,v.jsx)(l.Divider,{}),(0,v.jsxs)("div",{children:[(0,v.jsx)(l.Title,{order:5,children:(0,v.jsx)(C,{text:"Custom colors",scrollToId:"chatbot-custom-colors"})}),(0,v.jsx)(l.Text,{size:"sm",c:"dimmed",children:"Add named colors (hex) that can also be selected as the primary color."})]}),0===P.length&&(0,v.jsx)(l.Text,{size:"sm",c:"dimmed",children:"No custom colors yet."}),P.map(([e,t])=>(0,v.jsxs)(l.Group,{align:"flex-end",children:[(0,v.jsx)(l.TextInput,{label:"Name",defaultValue:e,onBlur:t=>{const a=t.currentTarget.value.trim();if(!a||a===e)return;if(a in M)return void(t.currentTarget.value=e);const l={...M},o=l[e];delete l[e],l[a]=o,L.setFieldValue("chatbot",{...L.values.chatbot,colors:Object.keys(l).length?l:void 0})},style:{flex:1}}),(0,v.jsx)(l.ColorInput,{label:"Hex",format:"hex",value:t,onChange:t=>{L.setFieldValue("chatbot",{...L.values.chatbot,colors:{...M,[e]:t}})},style:{flex:1}}),(0,v.jsx)(l.ActionIcon,{color:"red",variant:"light",onClick:()=>{const t={...M};delete t[e],L.setFieldValue("chatbot",{...L.values.chatbot,colors:Object.keys(t).length?t:void 0})},children:(0,v.jsx)(d.A,{size:16})})]},e)),(0,v.jsx)(l.Divider,{}),(0,v.jsxs)(l.Group,{align:"flex-end",children:[(0,v.jsx)(l.TextInput,{label:"New color name",placeholder:"e.g. brand",value:U,description:"Unique name for the color.",onChange:e=>X(e.currentTarget.value),style:{flex:1}}),(0,v.jsx)(l.ColorInput,{label:"Hex",format:"hex",value:K,description:"Color value in hex format.",onChange:q,style:{flex:1}}),(0,v.jsx)(l.Button,{leftSection:(0,v.jsx)(h.A,{size:16}),onClick:()=>{const e=U.trim();e&&(e in M||(L.setFieldValue("chatbot",{...L.values.chatbot,colors:{...M,[e]:K}}),X("")))},children:"Add"})]})]})}),(0,v.jsx)(l.Group,{justify:"flex-end",children:(0,v.jsx)(l.Button,{loading:I,variant:"gradient",type:"submit",leftSection:(0,v.jsx)(r.A,{}),children:"Save Chatbot Settings"})})]})}),(0,v.jsx)("div",{style:{zIndex:1e5},children:(0,v.jsx)(s._Z,{...V,store:S,previewMode:!0,onClose:()=>{}})})]})}},3514(e,t,a){async function l(e,t,a,l,o){const s=await fetch(`${e}/account/${t}/site/${a}/settings`,{method:"PUT",headers:{"Content-Type":"application/json","X-Site-Key":l,"X-Plugin":"ai-kit"},body:JSON.stringify({settings:o})});if(!s.ok){const e=await s.text();throw new Error(e||`HTTP error! status: ${s.status}`)}return(await s.json()).settings}a.d(t,{D:()=>l})}}]);